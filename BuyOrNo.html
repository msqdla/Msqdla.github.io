<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>è´­ç‰©å†³ç­–å™¨-æ’æŸ¥ç‰ˆ</title>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAMEryLz-AUsyD0nO_ELE-W0fZYYkvWH7c",
      authDomain: "buything-a5eb2.firebaseapp.com",
      databaseURL: "https://buything-a5eb2-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "buything-a5eb2",
      storageBucket: "buything-a5eb2.firebasestorage.app",
      messagingSenderId: "543394299235",
      appId: "1:543394299235:web:c1fdd04563a9cf7f43a756"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const roomId = "test1"; // å•ç‹¬æµ‹è¯•æˆ¿é—´
  </script>

  <style>
    body{font-family:Arial;background:#111;color:#eee;padding:40px;text-align:center}
    input{padding:8px 12px;margin:6px;width:220px}
    button{padding:8px 16px;margin:6px;cursor:pointer}
    .voter{margin:10px 0}
  </style>
</head>
<body>
  <h2>è´­ç‰©å†³ç­–å™¨-æ’æŸ¥ç‰ˆ</h2>

  <!-- 1. å•†å“ & å§“å -->
  <div>
    <label>å•†å“ï¼š</label><input id="itemName" placeholder="æƒ³ä¹°ä»€ä¹ˆ"><br>
    <label>å§“åï¼š</label><input id="myName" placeholder="ä½ çš„åå­—"><br>
    <button onclick="submitVote()">æäº¤å¹¶è¿›å…¥æŠ•ç¥¨</button>
  </div>

  <!-- 2. æŠ•ç¥¨åŒº -->
  <h3>æŠ•ç¥¨åŒº</h3>
  <div id="votersContainer"></div>

  <!-- 3. ç»“æœåŒº -->
  <h3>ç»“æœ</h3>
  <div id="result"></div>

  <script>
    /* æäº¤ï¼ˆå†™å…¥äº‘ç«¯ï¼‰ */
    function submitVote() {
      const item = document.getElementById('itemName').value.trim();
      const name = document.getElementById('myName').value.trim();
      if (!item || !name) { alert('å•†å“å’Œåå­—éƒ½è¦å¡«'); return; }

      // å†™æ•°æ®
      db.ref(`rooms/${roomId}/item`).set(item);
      db.ref(`rooms/${roomId}/votes/${name}`).set(null); // æœªæŠ•çŠ¶æ€
      console.log('âœ… å·²å†™å…¥äº‘ç«¯');
    }

    /* å®æ—¶ç›‘å¬ */
    db.ref(`rooms/${roomId}`).on('value', snap => {
      const data = snap.val() || {};
      console.log('ğŸ”¥ æ”¶åˆ°æ•°æ®', data);
      const item = data.item || "";
      const votes = data.votes || {};
      renderVotes(votes);
    });

    /* æ¸²æŸ“æŠ•ç¥¨åŒº */
    function renderVotes(votes) {
      const box = document.getElementById('votersContainer');
      box.innerHTML = "";
      for (const [name, vote] of Object.entries(votes)) {
        const voted = vote !== null;
        box.insertAdjacentHTML('beforeend', `
          <div class="voter">
            ${name}ï¼š${voted ? (vote === 'yes' ? 'âœ…ä¹°' : 'âŒä¸ä¹°') : 'â³æœªæŠ•'}
            ${!voted ? `
              <button onclick="vote('${name}', 'yes')">ä¹°</button>
              <button onclick="vote('${name}', 'no')">ä¸ä¹°</button>
            ` : ''}
          </div>
        `);
      }
    }

    /* æŠ•ç¥¨ */
    function vote(name, choice) {
      db.ref(`rooms/${roomId}/votes/${name}`).set(choice);
    }
  </script>
</body>
</html>
