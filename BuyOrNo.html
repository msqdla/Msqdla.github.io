<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´­ç‰©å†³ç­–å™¨</title>
    <!-- 1. Firebase å…¼å®¹åº“ -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <!-- 2. é…ç½® -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAMEryLz-AUsyD0nO_ELE-W0fZYYkvWH7c",
            authDomain: "buything-a5eb2.firebaseapp.com",
            databaseURL: "https://buything-a5eb2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "buything-a5eb2",
            storageBucket: "buything-a5eb2.firebasestorage.app",
            messagingSenderId: "543394299235",
            appId: "1:543394299235:web:c1fdd04563a9cf7f43a756"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const roomId = "room1";   // å›ºå®šæˆ¿é—´å·ï¼Œå¯æ”¹æˆåŠ¨æ€
    </script>

    <!-- åŸæ¥ä½ çš„æ ·å¼ï¼Œä¸æ¯«æœªåŠ¨ -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
            padding: 20px; color: #e0e0ff;
        }
        .container {
            background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px);
            border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2); padding: 40px;
            max-width: 600px; width: 100%;
        }
        h1 { text-align: center; color: #ffffff; margin-bottom: 30px; font-size: 2.5em; text-shadow: 0 0 10px rgba(77, 166, 255, 0.5); }
        label { display: block; margin-bottom: 10px; color: #a0a0ff; font-weight: bold; font-size: 1.1em; }
        input[type="text"] {
            width: 100%; padding: 12px; background: rgba(0, 0, 20, 0.3);
            border: 2px solid rgba(77, 166, 255, 0.3); border-radius: 8px;
            font-size: 16px; transition: all 0.3s; color: #ffffff;
        }
        input[type="text"]:focus { outline: none; border-color: #4da6ff; box-shadow: 0 0 10px rgba(77, 166, 255, 0.5); }
        .button-container { display: flex; gap: 20px; margin-bottom: 30px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.3s; color: white; }
        .start-btn { background: linear-gradient(135deg, #00c9ff, #92fe9d); }
        .start-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 201, 255, 0.4); }
        .reset-btn { background: linear-gradient(135deg, #ff416c, #ff4b2b); }
        .reset-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 65, 108, 0.4); }
        .voting-section { display: none; margin-top: 30px; }
        .voter { background: rgba(0, 0, 30, 0.3); padding: 20px; margin-bottom: 15px; border-radius: 10px; border-left: 4px solid #4da6ff; }
        .voter-name { font-weight: bold; color: #ffffff; margin-bottom: 10px; font-size: 1.1em; }
        .vote-buttons { display: flex; gap: 10px; }
        .vote-btn { flex: 1; padding: 10px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; transition: all 0.3s; font-weight: bold; }
        .yes-btn { background: linear-gradient(135deg, #00c9ff, #92fe9d); color: #003d4d; }
        .no-btn { background: linear-gradient(135deg, #ff416c, #ff4b2b); color: #ffffff; }
        .vote-btn:hover:not(.voted) { transform: scale(1.05); }
        .vote-btn.voted { cursor: not-allowed; opacity: 0.7; }
        .result-section { display: none; text-align: center; padding: 30px; border-radius: 10px; margin-top: 30px; background: rgba(0, 0, 30, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); }
        .result-buy { background: rgba(0, 100, 0, 0.2); border: 2px solid #00c9ff; }
        .result-not-buy { background: rgba(100, 0, 0, 0.2); border: 2px solid #ff416c; }
        .result-text { font-size: 24px; font-weight: bold; margin-bottom: 15px; text-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .vote-summary { font-size: 18px; color: #a0a0ff; }
        .yes-votes { color: #00c9ff; font-weight: bold; }
        .no-votes { color: #ff416c; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ è´­ç‰©å†³ç­–å™¨</h1>

        <div class="input-section">
            <label for="itemName">ä½ æƒ³ä¹°ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</label>
            <input type="text" id="itemName" placeholder="è¯·è¾“å…¥å•†å“åç§°">
        </div>

        <div class="voters-section">
            <label>å‚ä¸å†³ç­–çš„äººå‘˜ï¼ˆ3-5äººï¼‰ï¼š</label>
            <div id="votersList">
                <div class="voter-input"><input type="text" placeholder="è¾“å…¥å§“å" class="voter-name-input"></div>
                <div class="voter-input"><input type="text" placeholder="è¾“å…¥å§“å" class="voter-name-input"></div>
                <div class="voter-input"><input type="text" placeholder="è¾“å…¥å§“å" class="voter-name-input"></div>
            </div>
            <button class="add-voter-btn" onclick="addVoter()">+ æ·»åŠ å†³ç­–äººå‘˜</button>
        </div>

        <div class="button-container">
            <button class="start-btn" onclick="startVoting()">å¼€å§‹æŠ•ç¥¨</button>
            <button class="reset-btn" onclick="resetAll()">é‡ç½®</button>
        </div>

        <div id="votingSection" class="voting-section">
            <h3 style="text-align:center;margin-bottom:20px;color:#667eea;">è¯·æ¯ä¸ªäººæŠ•ç¥¨ï¼š</h3>
            <div id="votersContainer"></div>
        </div>

        <div id="resultSection" class="result-section">
            <div class="result-text" id="resultText"></div>
            <div class="vote-summary" id="voteSummary"></div>
        </div>
    </div>

    <!-- 3. ä¸šåŠ¡è„šæœ¬ -->
    <script>
        const roomId = "room1";
        let votes = {};
        let voterCount = 3;

        function addVoter() {
            if (voterCount >= 5) return alert('æœ€å¤šåªèƒ½æœ‰5ä¸ªå†³ç­–äººå‘˜ï¼');
            const votersList = document.getElementById('votersList');
            const div = document.createElement('div');
            div.className = 'voter-input';
            div.innerHTML = `<input type="text" placeholder="è¾“å…¥å§“å" class="voter-name-input">`;
            votersList.appendChild(div);
            voterCount++;
        }

        function startVoting() {
            const itemName = document.getElementById('itemName').value.trim();
            if (!itemName) return alert('è¯·è¾“å…¥è¦è´­ä¹°çš„å•†å“åç§°ï¼');
            const names = Array.from(document.querySelectorAll('.voter-name-input'))
                               .map(i => i.value.trim())
                               .filter(n => n);
            if (names.length < 3) return alert('è‡³å°‘éœ€è¦3ä¸ªå†³ç­–äººå‘˜ï¼');
            // å†™å…¥äº‘ç«¯ï¼šå•†å“å
            db.ref(`rooms/${roomId}/item`).set(itemName);
            // åˆå§‹åŒ–æŠ•ç¥¨èŠ‚ç‚¹
            names.forEach(n => db.ref(`rooms/${roomId}/votes/${n}`).set(null));
            listen();          // ç›‘å¬å®æ—¶æ•°æ®
        }

        function listen() {
            db.ref(`rooms/${roomId}`).on('value', snap => {
                const data = snap.val();
                if (!data) return;
                document.getElementById('itemName').value = data.item || '';
                renderVotes(data.votes || {});
            });
        }

        function renderVotes(votes) {
            const container = document.getElementById('votersContainer');
            const votingSection = document.getElementById('votingSection');
            const resultSection = document.getElementById('resultSection');
            container.innerHTML = '';
            let yes = 0, no = 0;
            for (const [name, v] of Object.entries(votes)) {
                if (v === 'yes') yes++; else if (v === 'no') no++;
                container.insertAdjacentHTML('beforeend', `
                    <div class="voter">
                        <div class="voter-name">${name}</div>
                        <div class="vote-buttons">
                            <button class="vote-btn yes-btn ${v ? 'voted' : ''}" ${v ? 'disabled' : ''}
                                onclick="vote('${name}', 'yes')">âœ“ ä¹°</button>
                            <button class="vote-btn no-btn ${v ? 'voted' : ''}" ${v ? 'disabled' : ''}
                                onclick="vote('${name}', 'no')">âœ— ä¸ä¹°</button>
                        </div>
                    </div>
                `);
            }
            votingSection.style.display = 'block';
            // å…¨å‘˜æŠ•å®Œæ˜¾ç¤ºç»“æœ
            if (Object.keys(votes).length >= 3 && Object.values(votes).every(v => v)) {
                resultSection.className = 'result-section ' + (yes > no ? 'result-buy' : 'result-not-buy');
                document.getElementById('resultText').innerHTML =
                    yes > no ? 'ğŸ‰ æ­å–œï¼å¯ä»¥è´­ä¹°ï¼' : no > yes ? 'âŒ å»ºè®®ä¸è¦è´­ä¹°ï¼' : 'ğŸ¤” å¹³å±€ï¼Œè°¨æ…è€ƒè™‘ï¼';
                document.getElementById('voteSummary').innerHTML = `æŠ•ç¥¨ç»“æœï¼š<span class="yes-votes">${yes}ç¥¨èµæˆ</span> | <span class="no-votes">${no}ç¥¨åå¯¹</span>`;
                resultSection.style.display = 'block';
            } else {
                resultSection.style.display = 'none';
            }
        }

        function vote(name, choice) {
            db.ref(`rooms/${roomId}/votes/${name}`).set(choice);
        }

        function resetAll() {
            if (confirm('ç¡®å®šè¦é‡ç½®æœ¬è½®æŠ•ç¥¨å—ï¼Ÿ')) {
                db.ref(`rooms/${roomId}`).remove();
                document.getElementById('votingSection').style.display = 'none';
                document.getElementById('resultSection').style.display = 'none';
                document.getElementById('itemName').value = '';
                document.querySelectorAll('.voter-name-input').forEach(i => i.value = '');
            }
        }
    </script>
</body>
</html>
